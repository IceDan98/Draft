<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Симулятор Драфта LoL (Fearless)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Размеры в vh/vmin */
            --ban-size-vh: 5.6vmin;
            --card-size-vh: 8.25vh;
            --nick-height-vh: 3.5vh;
            --nick-font-size-vh: 3vh;
            --button-size-vh: 4.5vh;
            --timer-font-size-vh: 2.2vh;
            --score-size-vh: 4.5vh;
            --score-font-size-vh: 2.2vh;
            --filter-button-size-vh: 4vh;
            --gap-size: 0.4rem;
             /* Минимальные размеры */
             --ban-min-size: 30px;
             --pick-min-height: 50px;
             --card-min-size: 45px;
             --nick-min-height: 18px;
             --button-min-size: 30px;
             --score-min-size: 30px;
             --team-name-min-height: 30px;
             --team-col-min-width: 260px;
             /* Используем --card-min-size для иконок глоб. банов */
             --global-ban-icon-min-size: var(--card-min-size);
         }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Cinzel', serif;
            background-image: linear-gradient(45deg, #10022b, #01052b); /* Еще темнее */
            color: #e2e8f0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 0.5rem;
        }
        #championSearch, .action-button, #timerDisplay, .score-input, .filter-button {
             font-family: 'Inter', sans-serif;
        }
        .nickname-input {
             font-family: 'Cinzel', serif;
        }


        /* Основной контейнер - GRID */
        #mainLayout {
            display: grid;
            grid-template-rows: auto 1fr; /* Строка для верха, остальное для драфта */
            grid-template-columns: auto minmax(200px, 1fr) auto; /* Колонки: Синие(баны), Центр(инфо), Красные(баны) */
            gap: var(--gap-size);
            height: 100%;
            width: 100%;
            max-width: 2400px; /* Макс ширина */
            max-height: calc(100vh - 1rem); /* Макс высота с учетом отступа body */
        }

         /* Верхняя строка с информацией и кнопками - GRID */
        #topRowContainer {
            grid-column: 1 / -1; /* Занимает все колонки */
            grid-row: 1; /* Первая строка */
            display: grid;
            grid-template-columns: subgrid; /* Используем колонки родителя #mainLayout */
            gap: var(--gap-size);
            align-items: center; /* Вертикальное выравнивание по центру */
            margin-bottom: var(--gap-size);
            min-height: calc(var(--button-size-vh) + var(--gap-size)); /* Минимальная высота */
        }

        /* Ячейки в верхней строке */
        .top-row-cell {
            display: flex;
            align-items: center; /* Вертикальное выравнивание */
            gap: var(--gap-size);
            min-width: 0; /* Предотвращает растягивание flex-элементов */
        }
        /* Выравнивание контента в ячейках */
        .top-row-cell.blue-info { grid-column: 1; justify-content: flex-start; } /* Баны синих слева */
        .top-row-cell.center-controls { grid-column: 2; justify-content: center; } /* Центр по центру */
        .top-row-cell.red-info { grid-column: 3; justify-content: flex-end; } /* Баны красных справа */


         /* Обертка для элементов в центре (Имя, Счет, Таймер, Счет, Имя) */
         .center-controls-wrapper {
            display: grid; /* Используем Grid */
            grid-template-columns: minmax(0, 1fr) max-content max-content max-content minmax(0, 1fr);
            align-items: center; /* Вертикальное выравнивание */
            gap: var(--gap-size);
            width: 100%; /* Занимаем всю ширину центральной ячейки grid */
         }

         /* Стили таймера */
         #timerDisplay {
             font-size: var(--timer-font-size-vh);
             font-weight: 600;
             color: #e2e8f0;
             min-width: 5ch; /* Примерно для 00:00 */
             text-align: center;
             background-color: #16a34a; /* Зеленый для старта */
             border: 1px solid #15803d;
             padding: 0.2rem 0.5rem;
             border-radius: 0.25rem;
             height: var(--button-size-vh); /* Размер как у кнопок */
             min-height: var(--button-min-size);
             display: flex;
             align-items: center;
             justify-content: center;
             cursor: pointer;
             transition: background-color 0.2s ease, opacity 0.2s ease;
         }
         #timerDisplay:hover:not(.timer-disabled) {
             background-color: #15803d; /* Темнее при наведении */
         }
         #timerDisplay.timer-disabled {
             cursor: default;
             background-color: rgba(0,0,0,0.2); /* Серый фон, когда неактивен */
             border: none;
             opacity: 0.8;
         }
         #timerDisplay.timer-running {
             background-color: rgba(0,0,0,0.2); /* Серый фон, когда идет */
             border: none;
             cursor: default;
         }


        /* Область драфта (колонки + сетка) - GRID */
        #draftArea {
            grid-column: 1 / -1; /* Занимает все колонки */
            grid-row: 2; /* Вторая строка */
            display: grid;
            grid-template-columns: subgrid; /* Используем колонки родителя #mainLayout */
            gap: var(--gap-size);
            overflow: hidden; /* Важно для дочерних скроллов */
            min-height: 0; /* Важно для flex/grid дочерних */
            align-items: stretch; /* Растягиваем дочерние элементы по высоте */
        }

        /* Стили колонок команд (теперь только пики) */
        .team-column {
             min-width: var(--team-col-min-width); /* Минимальная ширина колонки */
             width: auto; /* Автоматическая ширина */
             max-width: 450px; /* Максимальная ширина колонки */
             flex: 0 1 var(--team-col-min-width); /* Не растягивать, база - мин. ширина */
             padding: var(--gap-size);
             border-radius: 0.5rem;
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
             display: flex; /* Используем flex для picks-container */
             flex-direction: column;
             overflow-y: auto; /* Скролл колонки */
             scrollbar-width: none; /* Firefox */
             transition: opacity 0.3s ease;
             border: 1px solid #9ca3af; /* Добавлена обводка */
        }
         .team-column.blue-column { grid-column: 1; } /* Синяя колонка в 1-й grid-колонке */
         .team-column.red-column { grid-column: 3; } /* Красная колонка в 3-й grid-колонке */
         .team-column::-webkit-scrollbar { display: none; } /* Скрытие скроллбара */

        /* Используем RGBA для прозрачности фона (50%) */
        .blue-column { background-color: rgba(30, 58, 138, 0.5); }
        .red-column { background-color: rgba(153, 27, 27, 0.5); }

        /* Стили для слотов пиков/банов */
        .pick-slot, .ban-slot {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            flex-shrink: 0; /* Не сжиматься */
            border-radius: 0.375rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .ban-slot {
            width: var(--ban-size-vh);
            height: var(--ban-size-vh);
            min-width: var(--ban-min-size);
            min-height: var(--ban-min-size);
        }
        .pick-slot {
            min-height: var(--pick-min-height);
            width: 100%;
            height: auto; /* Авто высота */
            flex-grow: 1; /* Растягивается */
            position: relative; /* Для позиционирования ника */
        }
         /* Стили для img внутри слотов */
         .pick-slot img, .ban-slot img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover; /* Гарантирует обрезку */
            position: absolute; /* Добавлено для позиционирования */
            inset: 0;
            z-index: 0;
         }

        /* Стили для карточки чемпиона в сетке */
        .champion-card {
            width: var(--card-size-vh);
            height: var(--card-size-vh);
            min-width: var(--card-min-size);
            min-height: var(--card-min-size);
            border-radius: 0.25rem;
            overflow: hidden;
            background-color: #2d3748;
            cursor: pointer;
            transition: transform 0.15s ease-in-out;
            position: relative;
            flex-shrink: 0; /* Не сжиматься */
        }
         .champion-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
         }
        .champion-card:hover { transform: scale(1.08); }
        .champion-card.selected img { filter: grayscale(100%) brightness(50%); }
        .champion-card.disabled { pointer-events: none; opacity: 0.5; cursor: not-allowed; }
        .champion-card.disabled img { cursor: not-allowed; filter: grayscale(100%) brightness(50%); /* Применяем стиль disabled */ }

        /* Стили для подсветки */
        .highlight-action { border: 2px solid #fcd34d; box-shadow: 0 0 10px #fcd34d; }
        .swap-selected { outline: 3px solid #60a5fa; outline-offset: -1px; box-shadow: 0 0 15px #60a5fa; }

        /* --- Анимация мигания для предпросмотра --- */
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .preview-flash img { /* Применяем к картинке внутри слота с классом */
            animation: flash 1.2s infinite ease-in-out;
        }


        /* Кнопки */
        .action-button {
            color: white;
            width: var(--button-size-vh);
            height: var(--button-size-vh);
            min-width: var(--button-min-size);
            min-height: var(--button-min-size);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0; /* Убираем внутренние отступы */
            border-radius: 0.375rem;
            font-weight: 600;
            transition: background-color 0.2s ease, opacity 0.2s ease;
            border: 1px solid #9ca3af; /* Добавлена обводка */
            cursor: pointer;
            font-size: calc(var(--button-size-vh) * 0.5); /* Размер шрифта зависит от размера кнопки */
            line-height: 1; /* Убираем лишнюю высоту строки */
            flex-shrink: 0; /* Не сжиматься */
        }
         .icon-button { font-size: calc(var(--button-size-vh) * 0.6); padding: 0; width: var(--button-size-vh); }

        .action-buttons-group {
            display: flex;
            gap: var(--gap-size);
        }
        /* Порядок кнопок в группе */
        #swapButton { order: 1; background-color: #6b7280; } /* Серый */
        #swapButton:hover:not(:disabled) { background-color: #4b5563; }
        #clearPicksButton { order: 2; background-color: #ca8a04; } /* Желтый */
        #clearPicksButton:hover:not(:disabled) { background-color: #a16207; }
        #toggleTimerButton { order: 3; background-color: #0e7490; } /* Голубой */
        #toggleTimerButton:hover:not(:disabled) { background-color: #155e75; }
        #undoButton { order: 4; background-color: #4a5568; } /* Темно-серый */
        #resetButton { order: 5; background-color: #e53e3e; } /* Красный */


        .action-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .reset-button:hover:not(:disabled) { background-color: #c53030; }
        .undo-button:hover:not(:disabled) { background-color: #718096; }

        /* Стиль для кнопки подтверждения */
        .confirm-button {
            background-color: #16a34a; /* Зеленый */
        }
        .confirm-button:hover:not(:disabled) {
            background-color: #15803d; /* Темно-зеленый */
        }
        /* Стили для новой кнопки фильтра приоритета */
        #priorityFilterButton {
            background-color: #9333ea; /* Фиолетовый */
        }
        #priorityFilterButton:hover:not(:disabled) {
            background-color: #7e22ce;
        }
        #priorityFilterButton.active {
            background-color: #c084fc; /* Светло-фиолетовый */
            box-shadow: 0 0 8px #c084fc;
        }
        /* Стили для кнопки "Следующий драфт" */
        .next-draft-button {
            background-color: #ea580c; /* Оранжевый */
        }
        .next-draft-button:hover:not(:disabled) {
            background-color: #c2410c; /* Темно-оранжевый */
        }


        /* Сетка чемпионов */
        #championGridContainer {
             grid-column: 2; /* Центральная колонка драфта */
             background-color: rgba(31, 41, 55, 0.5); /* Темно-серый фон с 50% непрозрачности */
             border-radius: 0.5rem;
             padding: var(--gap-size);
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
             display: flex;
             flex-direction: column;
             overflow: hidden; /* Важно для скролла сетки */
             min-width: 200px; /* Мин. ширина центральной колонки */
             border: 1px solid #9ca3af; /* Добавлена обводка */
        }
         /* Контейнер для ГЛОБАЛЬНО забаненных чемпионов */
         #globallyBannedDisplay {
             flex-shrink: 0; /* Не сжиматься */
             margin-bottom: calc(var(--gap-size) * 2); /* Отступ снизу */
             display: flex; /* Используем flex для позиционирования заголовка и контейнера банов */
             flex-direction: column; /* Заголовок сверху, контейнер банов снизу */
             align-items: center; /* Центрируем заголовок */
             gap: var(--gap-size); /* Отступ между заголовком и банами */
             width: 100%;
             min-height: calc(var(--card-min-size) + var(--gap-size)); /* Минимальная высота */
             border-bottom: 1px solid #4a5568; /* Разделитель */
             padding-bottom: var(--gap-size); /* Отступ снизу */
         }
         /* Внутренний контейнер для ряда банов */
         .global-bans-row {
             display: flex;
             justify-content: space-between; /* Разносим синие и красные */
             width: 100%;
             align-items: flex-start; /* Выравниваем по верху */
         }
          /* Контейнеры для банов каждой команды - ИСПОЛЬЗУЕТСЯ GRID */
         #global-bans-blue, #global-bans-red {
             display: grid; /* Используем Grid */
             grid-template-columns: repeat(5, auto); /* Явно 5 колонок */
             gap: calc(var(--gap-size) / 2); /* Отступ между иконками */
             align-items: center; /* Центрируем иконки по вертикали */
             min-height: var(--global-ban-icon-min-size); /* Мин. высота на случай пустого контейнера */
             /* justify-content убран, т.к. grid сам расставляет */
             /* max-width убран */
         }

         /* Заголовок для глобальных банов - УБРАН ИЗ HTML */
         .global-bans-title {
             /* Стили остаются на случай, если решим вернуть */
             width: 100%;
             text-align: center;
             font-size: 0.9rem;
             color: #9ca3af;
             font-family: 'Inter', sans-serif;
             font-weight: 500;
         }

         .global-ban-icon {
             /* Размер как у карточек чемпионов */
             width: var(--card-size-vh);
             height: var(--card-size-vh);
             min-width: var(--card-min-size);
             min-height: var(--card-min-size);
             background-size: cover;
             background-position: center;
             border-radius: 0.25rem;
             overflow: hidden;
             flex-shrink: 0;
             background-color: #374151; /* Фон для пустых */
             border: 1px solid #4b5563;
             opacity: 0.6; /* Полупрозрачные */
             cursor: not-allowed; /* Курсор запрета */
         }
         .global-ban-icon img {
             display: block;
             width: 100%;
             height: 100%;
             object-fit: cover;
             filter: grayscale(100%) brightness(60%); /* Сепия и затемнение */
         }


         /* Контейнер для поиска и кнопок (включая фильтры) */
         .search-controls-wrapper {
             display: flex;
             align-items: center;
             gap: var(--gap-size);
             margin-bottom: var(--gap-size);
             flex-shrink: 0; /* Не сжиматься */
             flex-wrap: wrap; /* Разрешаем перенос */
         }
         #championSearch {
             flex-grow: 1; /* Занимает доступное место */
             font-size: clamp(0.8rem, 2vmin, 1rem); /* Адаптивный размер шрифта */
             min-width: 150px; /* Мин. ширина поиска */
         }
         /* Контейнер для кнопок фильтра (теперь внутри search-controls-wrapper) */
         #roleFilterButtons {
             display: flex;
             gap: var(--gap-size);
             flex-shrink: 0; /* Не сжиматься */
             flex-wrap: wrap; /* Перенос кнопок */
         }
         .filter-button {
             background-color: #374151; /* Серый фон */
             width: var(--filter-button-size-vh);
             height: var(--filter-button-size-vh);
             font-size: calc(var(--filter-button-size-vh) * 0.35); /* Размер шрифта зависит от кнопки */
             font-weight: 600;
             min-width: 32px; /* Мин. размер */
             min-height: 32px;
             display: flex;
             align-items: center;
             justify-content: center;
             padding: 0 2px; /* Небольшой отступ для текста */
             /* border: 1px solid transparent; */ /* Убрано, т.к. общая обводка добавлена в .action-button */
         }
         .filter-button svg.role-icon { /* Для иконок SVG, если будут */
             width: 65%;
             height: 65%;
             fill: currentColor;
             stroke: none;
         }
         .filter-button:hover:not(:disabled) {
             background-color: #4b5563; /* Темнее при наведении */
         }
         .filter-button.active {
             background-color: #1d4ed8; /* Темно-синий */
             border-color: #1d4ed8; /* Подсветка активного */
         }

        #championGrid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* Центрируем карточки */
            gap: calc(var(--gap-size) / 1.5); /* Уменьшенный отступ */
            overflow-y: auto; /* Скролл сетки */
            align-content: flex-start; /* Выравнивание строк сверху */
            flex-grow: 1; /* Занимает оставшееся место */
            min-height: 0; /* Важно для flex */
            transition: opacity 0.3s ease;
        }
         /* Стилизация скроллбара */
        #championGrid::-webkit-scrollbar { width: 6px; }
        #championGrid::-webkit-scrollbar-track { background: #2d3748; border-radius: 3px; }
        #championGrid::-webkit-scrollbar-thumb { background-color: #4a5568; border-radius: 3px; border: 1px solid #2d3748; }
        #championGrid::-webkit-scrollbar-thumb:hover { background-color: #718096; }
        #championGrid { scrollbar-width: thin; scrollbar-color: #4a5568 #2d3748; }

        /* Редактируемые поля */
        [contenteditable="true"] {
            padding: 0.15rem 0.3rem;
            border-radius: 0.25rem;
            background-color: rgba(0, 0, 0, 0.2);
            cursor: text;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        [contenteditable="true"]:focus { outline: 2px solid #fcd34d; background-color: rgba(0, 0, 0, 0.4); }

        /* Имя команды в верхней строке (теперь в центре) */
        .team-name {
            width: auto; /* Ширина по контенту */
            max-width: 250px; /* Увеличена ширина */
            text-align: center;
            font-size: clamp(1.1rem, 3.3vmin, 1.6rem); /* Адаптивный размер */
            font-weight: 700; /* Жирный */
            flex-shrink: 1; /* Разрешаем сжиматься */
             min-height: var(--team-name-min-height);
             line-height: var(--team-name-min-height); /* Вертикальное выравнивание */
             overflow: hidden;
             white-space: nowrap;
             text-overflow: ellipsis;
             justify-self: center;
             background-color: transparent; /* Убран фон от contenteditable */
             /* text-shadow: -1px -1px 0 #FFF, 1px -1px 0 #FFF, -1px 1px 0 #FFF, 1px 1px 0 #FFF; Убрана обводка */
        }
        /* Выравнивание имен в grid-колонках */
        #blue-team-name-h2 { justify-self: end; text-align: right; } /* Выравнивание вправо в своей колонке */
        #red-team-name-h2 { justify-self: start; text-align: left; } /* Выравнивание влево в своей колонке */

        /* Используем ID для цвета */
        #blue-team-name-h2 { color: #93c5fd; }
        #red-team-name-h2 { color: #fca5a5; }

         /* Поля для счета в верхней строке (теперь в центре) */
         .score-input {
             width: var(--score-size-vh);
             height: var(--score-size-vh);
             min-width: var(--score-min-size);
             min-height: var(--score-min-size);
             border: 2px solid #4a5568;
             border-radius: 0.375rem;
             display: flex;
             align-items: center;
             justify-content: center;
             font-size: var(--score-font-size-vh);
             font-weight: 700;
             flex-shrink: 0; /* Не сжиматься */
             justify-self: center; /* Центрируем в своей колонке */
         }
         .score-input:empty::before { /* Плейсхолдер для пустого счета */
             content: "0";
             color: #64748b; /* Серый цвет плейсхолдера */
         }
        /* Цвет для счета по ID */
         #blue-score { color: #93c5fd; }
         #red-score { color: #fca5a5; }


        /* Контейнер банов (теперь в верхней строке) */
        .bans-container {
             display: flex;
             justify-content: center;
             gap: calc(var(--gap-size) * 0.75); /* Уменьшенный отступ */
             flex-shrink: 0; /* Не сжиматься */
        }

        /* Контейнер пиков (остается в колонке команды) */
        .picks-container {
             display: flex;
             flex-direction: column;
             align-items: center;
             gap: calc(var(--gap-size) * 0.75); /* Уменьшенный отступ */
             flex-grow: 1; /* Растягивается по высоте */
             justify-content: space-around; /* Распределяет пики */
             width: 100%;
             min-height: 0; /* Важно для flex */
             margin-top: var(--gap-size); /* Добавлен отступ сверху, т.к. баны ушли */
        }


        /* Поле для ника игрока */
        .nickname-input[contenteditable="true"] {
            position: absolute;
            bottom: calc(2px + var(--nick-height-vh) * 0.1); /* Сдвиг вверх */
            /* left/right устанавливаются ниже */
            width: auto; /* Ширина по контенту */
            max-width: calc(100% - 8px); /* Не вылезать за края */
            z-index: 1; /* Поверх картинки */
            font-family: 'Cinzel', serif; /* Установлен шрифт Cinzel */
            font-size: var(--nick-font-size-vh);
            color: white;
            height: var(--nick-height-vh);
            min-height: var(--nick-min-height);
            background-color: transparent; /* Убран фон */
            border-radius: 0; /* Убрано скругление */
            padding: 0 4px; /* Горизонтальные отступы */
            text-shadow: /* Усиленная черная обводка */
                 -1.5px -1.5px 0 #000, 1.5px -1.5px 0 #000, -1.5px 1.5px 0 #000, 1.5px 1.5px 0 #000,
                 -1.5px 0 0 #000, 1.5px 0 0 #000, 0 -1.5px 0 #000, 0 1.5px 0 #000;
            pointer-events: auto; /* Всегда разрешаем события, т.к. родительский слот их обрабатывает */
            cursor: text; /* Курсор текста */
        }
         /* Выравнивание для синей команды - СПРАВА */
        [id^="blue-pick-"] .nickname-input {
            right: 2px;
            left: auto;
            text-align: right;
        }
         /* Выравнивание для красной команды - СЛЕВА */
        [id^="red-pick-"] .nickname-input {
            left: 2px;
            right: auto;
            text-align: left;
        }

        .nickname-input[contenteditable="true"]:empty::before { /* Плейсхолдер */
             content: "Ник игрока";
             color: #d1d5db; /* Светло-серый */
             font-style: italic;
             font-size: var(--nick-font-size-vh);
             text-shadow: /* Обводка для плейсхолдера */
                 -1.5px -1.5px 0 #000, 1.5px -1.5px 0 #000, -1.5px 1.5px 0 #000, 1.5px 1.5px 0 #000,
                 -1.5px 0 0 #000, 1.5px 0 0 #000, 0 -1.5px 0 #000, 0 1.5px 0 #000;
        }
        .nickname-input[contenteditable="true"]:focus {
             outline: 2px solid #fcd34d; /* Подсветка при фокусе */
             background-color: rgba(0, 0, 0, 0.3); /* Легкий фон при фокусе */
        }


        /* Класс для отключения взаимодействий до старта (теперь только для колонок) */
        .team-column.draft-disabled {
             pointer-events: none; /* Отключаем клики */
             opacity: 0.7; /* Делаем полупрозрачным */
        }


    </style>
</head>
<body class="flex flex-col items-center p-4">
    <div id="mainLayout">
        <div id="topRowContainer">
            <div class="top-row-cell blue-info">
                <div class="bans-container">
                    <div id="blue-ban-1" class="ban-slot"></div>
                    <div id="blue-ban-2" class="ban-slot"></div>
                    <div id="blue-ban-3" class="ban-slot"></div>
                    <div id="blue-ban-4" class="ban-slot"></div>
                    <div id="blue-ban-5" class="ban-slot"></div>
                </div>
            </div>

            <div class="top-row-cell center-controls">
                 <div class="center-controls-wrapper">
                     <h2 contenteditable="true" class="team-name" id="blue-team-name-h2">Синяя Команда</h2>
                     <div contenteditable="true" id="blue-score" class="score-input" inputmode="numeric"></div>
                     <div id="timerDisplay" title="Начать драфт">--:--</div>
                     <div contenteditable="true" id="red-score" class="score-input" inputmode="numeric"></div>
                     <h2 contenteditable="true" class="team-name" id="red-team-name-h2">Красная Команда</h2>
                 </div>
            </div>

            <div class="top-row-cell red-info">
                 <div class="bans-container">
                    <div id="red-ban-1" class="ban-slot"></div>
                    <div id="red-ban-2" class="ban-slot"></div>
                    <div id="red-ban-3" class="ban-slot"></div>
                    <div id="red-ban-4" class="ban-slot"></div>
                    <div id="red-ban-5" class="ban-slot"></div>
                 </div>
            </div>
        </div>

        <div id="draftArea">
            <div class="team-column blue-column draft-disabled">
                 <div class="picks-container blue-picks-container">
                     <div id="blue-pick-1" class="pick-slot"></div>
                     <div id="blue-pick-2" class="pick-slot"></div>
                     <div id="blue-pick-3" class="pick-slot"></div>
                     <div id="blue-pick-4" class="pick-slot"></div>
                     <div id="blue-pick-5" class="pick-slot"></div>
                 </div>
            </div>

            <div id="championGridContainer">
                 <div id="globallyBannedDisplay" class="hidden flex-col items-center"> <div class="global-bans-row flex justify-between w-full">
                         <div id="global-bans-blue" class="flex flex-wrap gap-1 justify-start"></div>
                         <div id="global-bans-red" class="flex flex-wrap gap-1 justify-end"></div>
                     </div>
                 </div>
                 <div class="search-controls-wrapper">
                     <input type="text" id="championSearch" placeholder="Поиск чемпиона..." class="p-2 rounded bg-gray-700 text-white border border-gray-600 focus:outline-none focus:border-blue-500 flex-grow">
                     <div id="roleFilterButtons" class="flex justify-center gap-2">
                         <button type="button" class="action-button filter-button active" data-role="All" title="Фильтр: Все">ALL</button>
                         <button type="button" class="action-button filter-button" data-role="Top" title="Фильтр: Топ">TOP</button>
                         <button type="button" class="action-button filter-button" data-role="Jungle" title="Фильтр: Лес">JNG</button>
                         <button type="button" class="action-button filter-button" data-role="Mid" title="Фильтр: Мид">MID</button>
                         <button type="button" class="action-button filter-button" data-role="ADC" title="Фильтр: АДК">ADC</button>
                         <button type="button" class="action-button filter-button" data-role="Support" title="Фильтр: Поддержка">SUP</button>
                     </div>
                     <button id="priorityFilterButton" class="action-button icon-button" title="Показать только приоритетных чемпионов">⭐</button>
                     <button id="confirmPickBanButton" class="action-button confirm-button icon-button" title="Подтвердить выбор/бан" disabled>✔️</button>
                     <button id="nextDraftButton" class="action-button next-draft-button icon-button" title="Следующий драфт" disabled>▶️</button>
                     <div class="action-buttons-group">
                         <button id="swapButton" class="action-button icon-button" title="Поменять команды местами">⇄</button>
                         <button id="clearPicksButton" class="action-button icon-button" title="Очистить пики/баны">❌</button>
                         <button id="toggleTimerButton" class="action-button icon-button" title="Сменить время таймера (30/45с)">⏱️</button>
                         <button id="undoButton" class="action-button undo-button icon-button" title="Отменить действие" disabled>↩</button>
                         <button id="resetButton" class="action-button reset-button icon-button" title="Сбросить драфт">🔄</button> </div>
                 </div>
                 <div id="championGrid"> </div>
            </div>

            <div class="team-column red-column draft-disabled">
                <div class="picks-container red-picks-container">
                     <div id="red-pick-1" class="pick-slot"></div>
                     <div id="red-pick-2" class="pick-slot"></div>
                     <div id="red-pick-3" class="pick-slot"></div>
                     <div id="red-pick-4" class="pick-slot"></div>
                     <div id="red-pick-5" class="pick-slot"></div>
                </div>
            </div>
        </div>
    </div>


    <script>
    try { // --- Глобальный try...catch для отладки ---

        // --- Данные о чемпионах (с ролями) ---
        const ddragonVersion = '14.7.1'; // Версия данных
        const baseIconUrl = `https://ddragon.leagueoflegends.com/cdn/${ddragonVersion}/img/champion/`;
        const baseSplashUrl = `https://ddragon.leagueoflegends.com/cdn/img/champion/splash/`;
        const getChampionById = (id) => champions.find(champ => champ.id === id);
        // Список чемпионов
        let champions = [ // Используем let, т.к. будем добавлять
            { id: 'Aatrox', name: 'Атрокс', roles: ['Top'], iconUrl: `${baseIconUrl}Aatrox.png`, splashUrl: `${baseSplashUrl}Aatrox_0.jpg` }, { id: 'Darius', name: 'Дариус', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Darius.png`, splashUrl: `${baseSplashUrl}Darius_0.jpg` }, { id: 'Garen', name: 'Гарен', roles: ['Top'], iconUrl: `${baseIconUrl}Garen.png`, splashUrl: `${baseSplashUrl}Garen_0.jpg` }, { id: 'Sett', name: 'Сетт', roles: ['Top', 'Support'], iconUrl: `${baseIconUrl}Sett.png`, splashUrl: `${baseSplashUrl}Sett_0.jpg` }, { id: 'Jayce', name: 'Джейс', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Jayce.png`, splashUrl: `${baseSplashUrl}Jayce_0.jpg` }, { id: 'Yone', name: 'Ёнэ', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Yone.png`, splashUrl: `${baseSplashUrl}Yone_0.jpg` }, { id: 'Jax', name: 'Джакс', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Jax.png`, splashUrl: `${baseSplashUrl}Jax_0.jpg` }, { id: 'Malphite', name: 'Мальфит', roles: ['Top', 'Support', 'Mid'], iconUrl: `${baseIconUrl}Malphite.png`, splashUrl: `${baseSplashUrl}Malphite_0.jpg` }, { id: 'Mordekaiser', name: 'Мордекайзер', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Mordekaiser.png`, splashUrl: `${baseSplashUrl}Mordekaiser_0.jpg` }, { id: 'Renekton', name: 'Ренектон', roles: ['Top'], iconUrl: `${baseIconUrl}Renekton.png`, splashUrl: `${baseSplashUrl}Renekton_0.jpg` }, { id: 'Sion', name: 'Сион', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Sion.png`, splashUrl: `${baseSplashUrl}Sion_0.jpg` }, { id: 'Gwen', name: 'Гвен', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Gwen.png`, splashUrl: `${baseSplashUrl}Gwen_0.jpg` }, { id: 'Riven', name: 'Ривен', roles: ['Top'], iconUrl: `${baseIconUrl}Riven.png`, splashUrl: `${baseSplashUrl}Riven_0.jpg` }, { id: 'Yorick', name: 'Йорик', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Yorick.png`, splashUrl: `${baseSplashUrl}Yorick_0.jpg` }, { id: 'Gangplank', name: 'Гангпланк', roles: ['Top'], iconUrl: `${baseIconUrl}Gangplank.png`, splashUrl: `${baseSplashUrl}Gangplank_0.jpg` }, { id: 'Gnar', name: 'Гнар', roles: ['Top'], iconUrl: `${baseIconUrl}Gnar.png`, splashUrl: `${baseSplashUrl}Gnar_0.jpg` }, { id: 'Fiora', name: 'Фиора', roles: ['Top'], iconUrl: `${baseIconUrl}Fiora.png`, splashUrl: `${baseSplashUrl}Fiora_0.jpg` }, { id: 'Kayle', name: 'Кейл', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Kayle.png`, splashUrl: `${baseSplashUrl}Kayle_0.jpg` }, { id: 'Volibear', name: 'Волибир', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Volibear.png`, splashUrl: `${baseSplashUrl}Volibear_0.jpg` }, { id: 'Irelia', name: 'Ирелия', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Irelia.png`, splashUrl: `${baseSplashUrl}Irelia_0.jpg` }, { id: 'Shen', name: 'Шен', roles: ['Top', 'Support'], iconUrl: `${baseIconUrl}Shen.png`, splashUrl: `${baseSplashUrl}Shen_0.jpg` }, { id: 'Teemo', name: 'Тимо', roles: ['Top'], iconUrl: `${baseIconUrl}Teemo.png`, splashUrl: `${baseSplashUrl}Teemo_0.jpg` }, { id: 'Ornn', name: 'Орн', roles: ['Top'], iconUrl: `${baseIconUrl}Ornn.png`, splashUrl: `${baseSplashUrl}Ornn_0.jpg` }, { id: 'Gragas', name: 'Грагас', roles: ['Jungle', 'Top', 'Mid', 'Support'], iconUrl: `${baseIconUrl}Gragas.png`, splashUrl: `${baseSplashUrl}Gragas_0.jpg` }, { id: 'Nasus', name: 'Насус', roles: ['Top'], iconUrl: `${baseIconUrl}Nasus.png`, splashUrl: `${baseSplashUrl}Nasus_0.jpg` }, { id: 'Camille', name: 'Камилла', roles: ['Top'], iconUrl: `${baseIconUrl}Camille.png`, splashUrl: `${baseSplashUrl}Camille_0.jpg` }, { id: 'Urgot', name: 'Ургот', roles: ['Top'], iconUrl: `${baseIconUrl}Urgot.png`, splashUrl: `${baseSplashUrl}Urgot_0.jpg` }, { id: 'DrMundo', name: 'Доктор Мундо', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}DrMundo.png`, splashUrl: `${baseSplashUrl}DrMundo_0.jpg` }, { id: 'KSante', name: 'К\'Санте', roles: ['Top'], iconUrl: `${baseIconUrl}KSante.png`, splashUrl: `${baseSplashUrl}KSante_0.jpg` }, { id: 'Chogath', name: 'Чо\'Гат', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Chogath.png`, splashUrl: `${baseSplashUrl}Chogath_0.jpg` }, { id: 'Tryndamere', name: 'Триндамир', roles: ['Top'], iconUrl: `${baseIconUrl}Tryndamere.png`, splashUrl: `${baseSplashUrl}Tryndamere_0.jpg` }, { id: 'Vladimir', name: 'Владимир', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Vladimir.png`, splashUrl: `${baseSplashUrl}Vladimir_0.jpg` }, { id: 'Yasuo', name: 'Ясуо', roles: ['Mid', 'Top', 'ADC'], iconUrl: `${baseIconUrl}Yasuo.png`, splashUrl: `${baseSplashUrl}Yasuo_0.jpg` }, { id: 'Singed', name: 'Синджед', roles: ['Top'], iconUrl: `${baseIconUrl}Singed.png`, splashUrl: `${baseSplashUrl}Singed_0.jpg` }, { id: 'Warwick', name: 'Варвик', roles: ['Jungle', 'Top'], iconUrl: `${baseIconUrl}Warwick.png`, splashUrl: `${baseSplashUrl}Warwick_0.jpg` }, { id: 'Pantheon', name: 'Пантеон', roles: ['Top', 'Mid', 'Support', 'Jungle'], iconUrl: `${baseIconUrl}Pantheon.png`, splashUrl: `${baseSplashUrl}Pantheon_0.jpg` }, { id: 'Rumble', name: 'Рамбл', roles: ['Top', 'Mid', 'Jungle'], iconUrl: `${baseIconUrl}Rumble.png`, splashUrl: `${baseSplashUrl}Rumble_0.jpg` }, { id: 'Illaoi', name: 'Иллаой', roles: ['Top'], iconUrl: `${baseIconUrl}Illaoi.png`, splashUrl: `${baseSplashUrl}Illaoi_0.jpg` }, { id: 'Trundle', name: 'Трандл', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Trundle.png`, splashUrl: `${baseSplashUrl}Trundle_0.jpg` }, { id: 'Quinn', name: 'Квинн', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Quinn.png`, splashUrl: `${baseSplashUrl}Quinn_0.jpg` }, { id: 'Kennen', name: 'Кеннен', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Kennen.png`, splashUrl: `${baseSplashUrl}Kennen_0.jpg` }, { id: 'Akali', name: 'Акали', roles: ['Mid', 'Top'], iconUrl: `${baseIconUrl}Akali.png`, splashUrl: `${baseSplashUrl}Akali_0.jpg` }, { id: 'Olaf', name: 'Олаф', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}Olaf.png`, splashUrl: `${baseSplashUrl}Olaf_0.jpg` }, { id: 'Kled', name: 'Клед', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Kled.png`, splashUrl: `${baseSplashUrl}Kled_0.jpg` }, { id: 'Poppy', name: 'Поппи', roles: ['Top', 'Jungle', 'Support'], iconUrl: `${baseIconUrl}Poppy.png`, splashUrl: `${baseSplashUrl}Poppy_0.jpg` }, { id: 'Heimerdinger', name: 'Хеймердингер', roles: ['Top', 'Mid', 'Support'], iconUrl: `${baseIconUrl}Heimerdinger.png`, splashUrl: `${baseSplashUrl}Heimerdinger_0.jpg` }, { id: 'Ryze', name: 'Райз', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Ryze.png`, splashUrl: `${baseSplashUrl}Ryze_0.jpg` }, { id: 'Wukong', name: 'Вуконг', roles: ['Top', 'Jungle'], iconUrl: `${baseIconUrl}MonkeyKing.png`, splashUrl: `${baseSplashUrl}MonkeyKing_0.jpg` }, { id: 'TahmKench', name: 'Таам Кенч', roles: ['Top', 'Support'], iconUrl: `${baseIconUrl}TahmKench.png`, splashUrl: `${baseSplashUrl}TahmKench_0.jpg` }, { id: 'Cassiopeia', name: 'Кассиопея', roles: ['Top', 'Mid'], iconUrl: `${baseIconUrl}Cassiopeia.png`, splashUrl: `${baseSplashUrl}Cassiopeia_0.jpg` }, { id: 'Nocturne', name: 'Ноктюрн', roles: ['Jungle'], iconUrl: `${baseIconUrl}Nocturne.png`, splashUrl: `${baseSplashUrl}Nocturne_0.jpg` }, { id: 'Shyvana', name: 'Шивана', roles: ['Jungle'], iconUrl: `${baseIconUrl}Shyvana.png`, splashUrl: `${baseSplashUrl}Shyvana_0.jpg` }, { id: 'Fiddlesticks', name: 'Фиддлстикс', roles: ['Jungle'], iconUrl: `${baseIconUrl}Fiddlesticks.png`, splashUrl: `${baseSplashUrl}Fiddlesticks_0.jpg` }, { id: 'JarvanIV', name: 'Джарван IV', roles: ['Jungle'], iconUrl: `${baseIconUrl}JarvanIV.png`, splashUrl: `${baseSplashUrl}JarvanIV_0.jpg` }, { id: 'Briar', name: 'Брайер', roles: ['Jungle'], iconUrl: `${baseIconUrl}Briar.png`, splashUrl: `${baseSplashUrl}Briar_0.jpg` }, { id: 'Amumu', name: 'Амуму', roles: ['Jungle', 'Support'], iconUrl: `${baseIconUrl}Amumu.png`, splashUrl: `${baseSplashUrl}Amumu_0.jpg` }, { id: 'XinZhao', name: 'Ксин Жао', roles: ['Jungle'], iconUrl: `${baseIconUrl}XinZhao.png`, splashUrl: `${baseSplashUrl}XinZhao_0.jpg` }, { id: 'Lillia', name: 'Лилия', roles: ['Jungle'], iconUrl: `${baseIconUrl}Lillia.png`, splashUrl: `${baseSplashUrl}Lillia_0.jpg` }, { id: 'Nunu', name: 'Нуну и Виллумп', roles: ['Jungle'], iconUrl: `${baseIconUrl}Nunu.png`, splashUrl: `${baseSplashUrl}Nunu_0.jpg` }, { id: 'Naafiri', name: 'Наафири', roles: ['Jungle', 'Mid'], iconUrl: `${baseIconUrl}Naafiri.png`, splashUrl: `${baseSplashUrl}Naafiri_0.jpg` }, { id: 'Kayn', name: 'Каин', roles: ['Jungle'], iconUrl: `${baseIconUrl}Kayn.png`, splashUrl: `${baseSplashUrl}Kayn_0.jpg` }, { id: 'Elise', name: 'Элиза', roles: ['Jungle'], iconUrl: `${baseIconUrl}Elise.png`, splashUrl: `${baseSplashUrl}Elise_0.jpg` }, { id: 'Ivern', name: 'Иверн', roles: ['Jungle', 'Support'], iconUrl: `${baseIconUrl}Ivern.png`, splashUrl: `${baseSplashUrl}Ivern_0.jpg` }, { id: 'Udyr', name: 'Удир', roles: ['Jungle', 'Top'], iconUrl: `${baseIconUrl}Udyr.png`, splashUrl: `${baseSplashUrl}Udyr_0.jpg` }, { id: 'Diana', name: 'Диана', roles: ['Jungle', 'Mid'], iconUrl: `${baseIconUrl}Diana.png`, splashUrl: `${baseSplashUrl}Diana_0.jpg` }, { id: 'Rammus', name: 'Раммус', roles: ['Jungle'], iconUrl: `${baseIconUrl}Rammus.png`, splashUrl: `${baseSplashUrl}Rammus_0.jpg` }, { id: 'Ekko', name: 'Экко', roles: ['Jungle', 'Mid'], iconUrl: `${baseIconUrl}Ekko.png`, splashUrl: `${baseSplashUrl}Ekko_0.jpg` }, { id: 'RekSai', name: 'Рек\'Сай', roles: ['Jungle'], iconUrl: `${baseIconUrl}RekSai.png`, splashUrl: `${baseSplashUrl}RekSai_0.jpg` }, { id: 'KhaZix', name: 'Ка\'Зикс', roles: ['Jungle'], iconUrl: `${baseIconUrl}Khazix.png`, splashUrl: `${baseSplashUrl}Khazix_0.jpg` }, { id: 'MasterYi', name: 'Мастер Йи', roles: ['Jungle'], iconUrl: `${baseIconUrl}MasterYi.png`, splashUrl: `${baseSplashUrl}MasterYi_0.jpg` }, { id: 'Vi', name: 'Вай', roles: ['Jungle'], iconUrl: `${baseIconUrl}Vi.png`, splashUrl: `${baseSplashUrl}Vi_0.jpg` }, { id: 'Talon', name: 'Талон', roles: ['Jungle', 'Mid'], iconUrl: `${baseIconUrl}Talon.png`, splashUrl: `${baseSplashUrl}Talon_0.jpg` }, { id: 'Kindred', name: 'Киндред', roles: ['Jungle'], iconUrl: `${baseIconUrl}Kindred.png`, splashUrl: `${baseSplashUrl}Kindred_0.jpg` }, { id: 'Hecarim', name: 'Гекарим', roles: ['Jungle'], iconUrl: `${baseIconUrl}Hecarim.png`, splashUrl: `${baseSplashUrl}Hecarim_0.jpg` }, { id: 'Taliyah', name: 'Талия', roles: ['Jungle', 'Mid'], iconUrl: `${baseIconUrl}Taliyah.png`, splashUrl: `${baseSplashUrl}Taliyah_0.jpg` }, { id: 'Maokai', name: 'Маокай', roles: ['Jungle', 'Support'], iconUrl: `${baseIconUrl}Maokai.png`, splashUrl: `${baseSplashUrl}Maokai_0.jpg` }, { id: 'Zyra', name: 'Зайра', roles: ['Support', 'Jungle'], iconUrl: `${baseIconUrl}Zyra.png`, splashUrl: `${baseSplashUrl}Zyra_0.jpg` }, { id: 'Zac', name: 'Зак', roles: ['Jungle'], iconUrl: `${baseIconUrl}Zac.png`, splashUrl: `${baseSplashUrl}Zac_0.jpg` }, { id: 'Belveth', name: 'Бел\'Вет', roles: ['Jungle'], iconUrl: `${baseIconUrl}Belveth.png`, splashUrl: `${baseSplashUrl}Belveth_0.jpg` }, { id: 'Qiyana', name: 'Киана', roles: ['Jungle', 'Mid'], iconUrl: `${baseIconUrl}Qiyana.png`, splashUrl: `${baseSplashUrl}Qiyana_0.jpg` }, { id: 'Karthus', name: 'Картус', roles: ['Jungle', 'Mid'], iconUrl: `${baseIconUrl}Karthus.png`, splashUrl: `${baseSplashUrl}Karthus_0.jpg` }, { id: 'Viego', name: 'Виего', roles: ['Jungle'], iconUrl: `${baseIconUrl}Viego.png`, splashUrl: `${baseSplashUrl}Viego_0.jpg` }, { id: 'Graves', name: 'Грейвз', roles: ['Jungle'], iconUrl: `${baseIconUrl}Graves.png`, splashUrl: `${baseSplashUrl}Graves_0.jpg` }, { id: 'Sejuani', name: 'Седжуани', roles: ['Jungle'], iconUrl: `${baseIconUrl}Sejuani.png`, splashUrl: `${baseSplashUrl}Sejuani_0.jpg` }, { id: 'Evelynn', name: 'Эвелинн', roles: ['Jungle'], iconUrl: `${baseIconUrl}Evelynn.png`, splashUrl: `${baseSplashUrl}Evelynn_0.jpg` }, { id: 'Shaco', name: 'Шако', roles: ['Jungle', 'Support'], iconUrl: `${baseIconUrl}Shaco.png`, splashUrl: `${baseSplashUrl}Shaco_0.jpg` }, { id: 'LeeSin', name: 'Ли Син', roles: ['Jungle'], iconUrl: `${baseIconUrl}LeeSin.png`, splashUrl: `${baseSplashUrl}LeeSin_0.jpg` }, { id: 'Zed', name: 'Зед', roles: ['Mid', 'Jungle'], iconUrl: `${baseIconUrl}Zed.png`, splashUrl: `${baseSplashUrl}Zed_0.jpg` }, { id: 'Brand', name: 'Брэнд', roles: ['Support', 'Mid', 'Jungle'], iconUrl: `${baseIconUrl}Brand.png`, splashUrl: `${baseSplashUrl}Brand_0.jpg` }, { id: 'Rengar', name: 'Ренгар', roles: ['Jungle', 'Top'], iconUrl: `${baseIconUrl}Rengar.png`, splashUrl: `${baseSplashUrl}Rengar_0.jpg` }, { id: 'Nidalee', name: 'Нидали', roles: ['Jungle'], iconUrl: `${baseIconUrl}Nidalee.png`, splashUrl: `${baseSplashUrl}Nidalee_0.jpg` }, { id: 'Skarner', name: 'Скарнер', roles: ['Jungle', 'Top'], iconUrl: `${baseIconUrl}Skarner.png`, splashUrl: `${baseSplashUrl}Skarner_0.jpg` }, { id: 'Zilean', name: 'Зилеан', roles: ['Support', 'Mid'], iconUrl: `${baseIconUrl}Zilean.png`, splashUrl: `${baseSplashUrl}Zilean_0.jpg` }, { id: 'Anivia', name: 'Анивия', roles: ['Mid'], iconUrl: `${baseIconUrl}Anivia.png`, splashUrl: `${baseSplashUrl}Anivia_0.jpg` }, { id: 'Swain', name: 'Свейн', roles: ['Support', 'Mid', 'ADC'], iconUrl: `${baseIconUrl}Swain.png`, splashUrl: `${baseSplashUrl}Swain_0.jpg` }, { id: 'Ahri', name: 'Ари', roles: ['Mid'], iconUrl: `${baseIconUrl}Ahri.png`, splashUrl: `${baseSplashUrl}Ahri_0.jpg` }, { id: 'Annie', name: 'Энни', roles: ['Mid', 'Support'], iconUrl: `${baseIconUrl}Annie.png`, splashUrl: `${baseSplashUrl}Annie_0.jpg` }, { id: 'Malzahar', name: 'Мальзахар', roles: ['Mid'], iconUrl: `${baseIconUrl}Malzahar.png`, splashUrl: `${baseSplashUrl}Malzahar_0.jpg` }, { id: 'Neeko', name: 'Нико', roles: ['Mid', 'Support'], iconUrl: `${baseIconUrl}Neeko.png`, splashUrl: `${baseSplashUrl}Neeko_0.jpg` }, { id: 'Vex', name: 'Векс', roles: ['Mid'], iconUrl: `${baseIconUrl}Vex.png`, splashUrl: `${baseSplashUrl}Vex_0.jpg` }, { id: 'Lissandra', name: 'Лиссандра', roles: ['Mid'], iconUrl: `${baseIconUrl}Lissandra.png`, splashUrl: `${baseSplashUrl}Lissandra_0.jpg` }, { id: 'VelKoz', name: 'Вел\'Коз', roles: ['Mid', 'Support'], iconUrl: `${baseIconUrl}Velkoz.png`, splashUrl: `${baseSplashUrl}Velkoz_0.jpg` }, { id: 'Galio', name: 'Галио', roles: ['Mid', 'Support'], iconUrl: `${baseIconUrl}Galio.png`, splashUrl: `${baseSplashUrl}Galio_0.jpg` }, { id: 'Veigar', name: 'Вейгар', roles: ['Mid', 'ADC'], iconUrl: `${baseIconUrl}Veigar.png`, splashUrl: `${baseSplashUrl}Veigar_0.jpg` }, { id: 'Viktor', name: 'Виктор', roles: ['Mid'], iconUrl: `${baseIconUrl}Viktor.png`, splashUrl: `${baseSplashUrl}Viktor_0.jpg` }, { id: 'Xerath', name: 'Зерат', roles: ['Mid', 'Support'], iconUrl: `${baseIconUrl}Xerath.png`, splashUrl: `${baseSplashUrl}Xerath_0.jpg` }, { id: 'Akshan', name: 'Акшан', roles: ['Mid', 'Top'], iconUrl: `${baseIconUrl}Akshan.png`, splashUrl: `${baseSplashUrl}Akshan_0.jpg` }, { id: 'AurelionSol', name: 'Аурелион Сол', roles: ['Mid'], iconUrl: `${baseIconUrl}AurelionSol.png`, splashUrl: `${baseSplashUrl}AurelionSol_0.jpg` }, { id: 'Syndra', name: 'Синдра', roles: ['Mid'], iconUrl: `${baseIconUrl}Syndra.png`, splashUrl: `${baseSplashUrl}Syndra_0.jpg` }, { id: 'Hwei', name: 'Хвэй', roles: ['Mid'], iconUrl: `${baseIconUrl}Hwei.png`, splashUrl: `${baseSplashUrl}Hwei_0.jpg` }, { id: 'TwistedFate', name: 'Твистед Фэйт', roles: ['Mid', 'ADC'], iconUrl: `${baseIconUrl}TwistedFate.png`, splashUrl: `${baseSplashUrl}TwistedFate_0.jpg` }, { id: 'Kassadin', name: 'Кассадин', roles: ['Mid'], iconUrl: `${baseIconUrl}Kassadin.png`, splashUrl: `${baseSplashUrl}Kassadin_0.jpg` }, { id: 'Orianna', name: 'Орианна', roles: ['Mid'], iconUrl: `${baseIconUrl}Orianna.png`, splashUrl: `${baseSplashUrl}Orianna_0.jpg` }, { id: 'Katarina', name: 'Катарина', roles: ['Mid'], iconUrl: `${baseIconUrl}Katarina.png`, splashUrl: `${baseSplashUrl}Katarina_0.jpg` }, { id: 'Lux', name: 'Люкс', roles: ['Mid', 'Support'], iconUrl: `${baseIconUrl}Lux.png`, splashUrl: `${baseSplashUrl}Lux_0.jpg` }, { id: 'Sylas', name: 'Сайлас', roles: ['Mid'], iconUrl: `${baseIconUrl}Sylas.png`, splashUrl: `${baseSplashUrl}Sylas_0.jpg` }, { id: 'Fizz', name: 'Физз', roles: ['Mid'], iconUrl: `${baseIconUrl}Fizz.png`, splashUrl: `${baseSplashUrl}Fizz_0.jpg` }, { id: 'Ziggs', name: 'Зиггс', roles: ['Mid', 'ADC'], iconUrl: `${baseIconUrl}Ziggs.png`, splashUrl: `${baseSplashUrl}Ziggs_0.jpg` }, { id: 'Corki', name: 'Корки', roles: ['Mid', 'ADC'], iconUrl: `${baseIconUrl}Corki.png`, splashUrl: `${baseSplashUrl}Corki_0.jpg` }, { id: 'Azir', name: 'Азир', roles: ['Mid'], iconUrl: `${baseIconUrl}Azir.png`, splashUrl: `${baseSplashUrl}Azir_0.jpg` }, { id: 'Leblanc', name: 'Ле Блан', roles: ['Mid'], iconUrl: `${baseIconUrl}Leblanc.png`, splashUrl: `${baseSplashUrl}Leblanc_0.jpg` }, { id: 'Smolder', name: 'Смолдер', roles: ['ADC', 'Mid'], iconUrl: `${baseIconUrl}Smolder.png`, splashUrl: `${baseSplashUrl}Smolder_0.jpg` }, { id: 'Nilah', name: 'Нила', roles: ['ADC'], iconUrl: `${baseIconUrl}Nilah.png`, splashUrl: `${baseSplashUrl}Nilah_0.jpg` }, { id: 'Jinx', name: 'Джинкс', roles: ['ADC'], iconUrl: `${baseIconUrl}Jinx.png`, splashUrl: `${baseSplashUrl}Jinx_0.jpg` }, { id: 'Vayne', name: 'Вейн', roles: ['ADC', 'Top'], iconUrl: `${baseIconUrl}Vayne.png`, splashUrl: `${baseSplashUrl}Vayne_0.jpg` }, { id: 'Tristana', name: 'Тристана', roles: ['ADC'], iconUrl: `${baseIconUrl}Tristana.png`, splashUrl: `${baseSplashUrl}Tristana_0.jpg` }, { id: 'Sivir', name: 'Сивир', roles: ['ADC'], iconUrl: `${baseIconUrl}Sivir.png`, splashUrl: `${baseSplashUrl}Sivir_0.jpg` }, { id: 'Lucian', name: 'Люциан', roles: ['ADC'], iconUrl: `${baseIconUrl}Lucian.png`, splashUrl: `${baseSplashUrl}Lucian_0.jpg` }, { id: 'MissFortune', name: 'Мисс Фортуна', roles: ['ADC'], iconUrl: `${baseIconUrl}MissFortune.png`, splashUrl: `${baseSplashUrl}MissFortune_0.jpg` }, { id: 'Twitch', name: 'Твич', roles: ['ADC'], iconUrl: `${baseIconUrl}Twitch.png`, splashUrl: `${baseSplashUrl}Twitch_0.jpg` }, { id: 'Xayah', name: 'Шая', roles: ['ADC'], iconUrl: `${baseIconUrl}Xayah.png`, splashUrl: `${baseSplashUrl}Xayah_0.jpg` }, { id: 'Jhin', name: 'Джин', roles: ['ADC'], iconUrl: `${baseIconUrl}Jhin.png`, splashUrl: `${baseSplashUrl}Jhin_0.jpg` }, { id: 'Aphelios', name: 'Афелий', roles: ['ADC'], iconUrl: `${baseIconUrl}Aphelios.png`, splashUrl: `${baseSplashUrl}Aphelios_0.jpg` }, { id: 'Zeri', name: 'Зери', roles: ['ADC'], iconUrl: `${baseIconUrl}Zeri.png`, splashUrl: `${baseSplashUrl}Zeri_0.jpg` }, { id: 'Samira', name: 'Самира', roles: ['ADC'], iconUrl: `${baseIconUrl}Samira.png`, splashUrl: `${baseSplashUrl}Samira_0.jpg` }, { id: 'Draven', name: 'Дрейвен', roles: ['ADC'], iconUrl: `${baseIconUrl}Draven.png`, splashUrl: `${baseSplashUrl}Draven_0.jpg` }, { id: 'Caitlyn', name: 'Кейтлин', roles: ['ADC'], iconUrl: `${baseIconUrl}Caitlyn.png`, splashUrl: `${baseSplashUrl}Caitlyn_0.jpg` }, { id: 'Kaisa', name: 'Кай\'Са', roles: ['ADC'], iconUrl: `${baseIconUrl}Kaisa.png`, splashUrl: `${baseSplashUrl}Kaisa_0.jpg` }, { id: 'Ashe', name: 'Эш', roles: ['ADC', 'Support'], iconUrl: `${baseIconUrl}Ashe.png`, splashUrl: `${baseSplashUrl}Ashe_0.jpg` }, { id: 'Varus', name: 'Варус', roles: ['ADC'], iconUrl: `${baseIconUrl}Varus.png`, splashUrl: `${baseSplashUrl}Varus_0.jpg` }, { id: 'Taric', name: 'Тарик', roles: ['Support'], iconUrl: `${baseIconUrl}Taric.png`, splashUrl: `${baseSplashUrl}Taric_0.jpg` }, { id: 'Nami', name: 'Нами', roles: ['Support'], iconUrl: `${baseIconUrl}Nami.png`, splashUrl: `${baseSplashUrl}Nami_0.jpg` }, { id: 'Janna', name: 'Жанна', roles: ['Support'], iconUrl: `${baseIconUrl}Janna.png`, splashUrl: `${baseSplashUrl}Janna_0.jpg` }, { id: 'Braum', name: 'Браум', roles: ['Support'], iconUrl: `${baseIconUrl}Braum.png`, splashUrl: `${baseSplashUrl}Braum_0.jpg` }, { id: 'Lulu', name: 'Лулу', roles: ['Support'], iconUrl: `${baseIconUrl}Lulu.png`, splashUrl: `${baseSplashUrl}Lulu_0.jpg` }, { id: 'Milio', name: 'Милио', roles: ['Support'], iconUrl: `${baseIconUrl}Milio.png`, splashUrl: `${baseSplashUrl}Milio_0.jpg` }, { id: 'Sona', name: 'Сона', roles: ['Support'], iconUrl: `${baseIconUrl}Sona.png`, splashUrl: `${baseSplashUrl}Sona_0.jpg` }, { id: 'Yuumi', name: 'Юми', roles: ['Support'], iconUrl: `${baseIconUrl}Yuumi.png`, splashUrl: `${baseSplashUrl}Yuumi_0.jpg` }, { id: 'Thresh', name: 'Треш', roles: ['Support'], iconUrl: `${baseIconUrl}Thresh.png`, splashUrl: `${baseSplashUrl}Thresh_0.jpg` }, { id: 'Alistar', name: 'Алистар', roles: ['Support'], iconUrl: `${baseIconUrl}Alistar.png`, splashUrl: `${baseSplashUrl}Alistar_0.jpg` }, { id: 'Rell', name: 'Релл', roles: ['Support'], iconUrl: `${baseIconUrl}Rell.png`, splashUrl: `${baseSplashUrl}Rell_0.jpg` }, { id: 'Bard', name: 'Бард', roles: ['Support'], iconUrl: `${baseIconUrl}Bard.png`, splashUrl: `${baseSplashUrl}Bard_0.jpg` }, { id: 'Rakan', name: 'Рэйкан', roles: ['Support'], iconUrl: `${baseIconUrl}Rakan.png`, splashUrl: `${baseSplashUrl}Rakan_0.jpg` }, { id: 'Leona', name: 'Леона', roles: ['Support'], iconUrl: `${baseIconUrl}Leona.png`, splashUrl: `${baseSplashUrl}Leona_0.jpg` }, { id: 'Seraphine', name: 'Серафина', roles: ['Support', 'Mid'], iconUrl: `${baseIconUrl}Seraphine.png`, splashUrl: `${baseSplashUrl}Seraphine_0.jpg` }, { id: 'RenataGlasc', name: 'Рената Гласк', roles: ['Support'], iconUrl: `${baseIconUrl}Renata.png`, splashUrl: `${baseSplashUrl}Renata_0.jpg` }, { id: 'Karma', name: 'Карма', roles: ['Support', 'Mid'], iconUrl: `${baseIconUrl}Karma.png`, splashUrl: `${baseSplashUrl}Karma_0.jpg` }, { id: 'Nautilus', name: 'Наутилус', roles: ['Support'], iconUrl: `${baseIconUrl}Nautilus.png`, splashUrl: `${baseSplashUrl}Nautilus_0.jpg` }, { id: 'Pyke', name: 'Пайк', roles: ['Support', 'Mid'], iconUrl: `${baseIconUrl}Pyke.png`, splashUrl: `${baseSplashUrl}Pyke_0.jpg` }, { id: 'Blitzcrank', name: 'Блицкранк', roles: ['Support'], iconUrl: `${baseIconUrl}Blitzcrank.png`, splashUrl: `${baseSplashUrl}Blitzcrank_0.jpg` }, { id: 'Soraka', name: 'Сорака', roles: ['Support'], iconUrl: `${baseIconUrl}Soraka.png`, splashUrl: `${baseSplashUrl}Soraka_0.jpg` }, { id: 'Zoe', name: 'Зои', roles: ['Mid', 'Support'], iconUrl: `${baseIconUrl}Zoe.png`, splashUrl: `${baseSplashUrl}Zoe_0.jpg` },
            // --- ДОБАВЛЕННЫЕ ПЛЕЙСХОЛДЕРЫ (УДАЛЕНЫ) ---
            // { id: 'NewChamp1', name: 'Чемпион 163?', roles: ['Mid'], iconUrl: `${baseIconUrl}Annie.png`, splashUrl: `${baseSplashUrl}Annie_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // { id: 'NewChamp2', name: 'Чемпион 164?', roles: ['Top'], iconUrl: `${baseIconUrl}Aatrox.png`, splashUrl: `${baseSplashUrl}Aatrox_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // { id: 'NewChamp3', name: 'Чемпион 165?', roles: ['Jungle'], iconUrl: `${baseIconUrl}Vi.png`, splashUrl: `${baseSplashUrl}Vi_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // { id: 'NewChamp4', name: 'Чемпион 166?', roles: ['ADC'], iconUrl: `${baseIconUrl}Jinx.png`, splashUrl: `${baseSplashUrl}Jinx_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // { id: 'NewChamp5', name: 'Чемпион 167?', roles: ['Support'], iconUrl: `${baseIconUrl}Lulu.png`, splashUrl: `${baseSplashUrl}Lulu_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // { id: 'NewChamp6', name: 'Чемпион 168?', roles: ['Mid'], iconUrl: `${baseIconUrl}Ahri.png`, splashUrl: `${baseSplashUrl}Ahri_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // { id: 'NewChamp7', name: 'Чемпион 169?', roles: ['Top'], iconUrl: `${baseIconUrl}Garen.png`, splashUrl: `${baseSplashUrl}Garen_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // { id: 'NewChamp8', name: 'Чемпион 170?', roles: ['Support'], iconUrl: `${baseIconUrl}Janna.png`, splashUrl: `${baseSplashUrl}Janna_0.jpg` }, // Placeholder - Update ID, Name, Roles, URLs!
            // --- ДОБАВЛЕННЫЕ ЧЕМПИОНЫ ---
            { id: 'Ezreal', name: 'Эзреаль', roles: ['ADC'], iconUrl: `${baseIconUrl}Ezreal.png`, splashUrl: `${baseSplashUrl}Ezreal_0.jpg` },
            { id: 'Kalista', name: 'Калиста', roles: ['ADC'], iconUrl: `${baseIconUrl}Kalista.png`, splashUrl: `${baseSplashUrl}Kalista_0.jpg` },
            { id: 'KogMaw', name: 'Ког\'Мао', roles: ['ADC'], iconUrl: `${baseIconUrl}KogMaw.png`, splashUrl: `${baseSplashUrl}KogMaw_0.jpg` },
            { id: 'Morgana', name: 'Моргана', roles: ['Support', 'Mid', 'Jungle'], iconUrl: `${baseIconUrl}Morgana.png`, splashUrl: `${baseSplashUrl}Morgana_0.jpg` },
            { id: 'Senna', name: 'Сенна', roles: ['Support'], iconUrl: `${baseIconUrl}Senna.png`, splashUrl: `${baseSplashUrl}Senna_0.jpg` },
        ];


        // --- Логика Драфта ---
        const championGridElement = document.getElementById('championGrid');
        const startButton = document.getElementById('timerDisplay');
        const resetButton = document.getElementById('resetButton');
        const undoButton = document.getElementById('undoButton');
        const timerDisplay = document.getElementById('timerDisplay');
        const championSearch = document.getElementById('championSearch');
        const bluePicksContainer = document.querySelector('.blue-picks-container');
        const redPicksContainer = document.querySelector('.red-picks-container');
        const blueColumn = document.querySelector('.blue-column');
        const redColumn = document.querySelector('.red-column');
        const swapButton = document.getElementById('swapButton');
        const clearPicksButton = document.getElementById('clearPicksButton');
        const toggleTimerButton = document.getElementById('toggleTimerButton');
        const filterButtons = document.querySelectorAll('.filter-button');
        const gridContainer = document.getElementById('championGridContainer');
        const confirmPickBanButton = document.getElementById('confirmPickBanButton');
        const priorityFilterButton = document.getElementById('priorityFilterButton');
        const nextDraftButton = document.getElementById('nextDraftButton');
        const globallyBannedDisplay = document.getElementById('globallyBannedDisplay');
        // const modeSwitchButton = document.getElementById('modeSwitchButton'); // Удалено

        let currentStep = 0;
        let selectedChampions = new Set();
        let currentChampionCards = [];
        let draftHistory = [];
        let isDraftComplete = false;
        let selectedSwapSlotId = null;
        let timerInterval = null;
        let draftTimerDuration = 30;
        let timerSeconds = draftTimerDuration;
        let isDraftStarted = false;
        let currentRoleFilter = 'All';
        let previewedChampion = null;
        let isPriorityFilterActive = false;

        // --- Состояние Fearless ---
        // Убраны переменные режимов
        let globallyDisabledChampions = new Set();
        let globalBanHistory = [];


        // Список приоритетных чемпионов (можно настроить)
        const priorityChampions = new Set([
            'Aatrox', 'Ahri', 'Akali', 'Akshan', 'Alistar', 'Amumu', 'Annie', 'Ashe', 'AurelionSol',
            'Blitzcrank', 'Brand', 'Braum', 'Caitlyn', 'Camille', 'Corki', 'Darius', 'Diana',
            'DrMundo', 'Draven', 'Ekko', 'Evelynn', 'Ezreal', 'Fiddlesticks', 'Fiora', 'Fizz',
            'Galio', 'Garen', 'Gnar', 'Gragas', 'Graves', 'Gwen', 'Hecarim', 'Heimerdinger',
            'Irelia', 'Janna', 'JarvanIV', 'Jax', 'Jayce', 'Jhin', 'Jinx', 'Kaisa', 'Kalista',
            'Karma', 'Kassadin', 'Katarina', 'Kayle', 'Kayn', 'Kennen', 'Khazix', 'Kindred',
            'LeeSin', 'Leona', 'Lillia', 'Lissandra', 'Lucian', 'Lulu', 'Lux', 'Malphite',
            'Maokai', 'MasterYi', 'Milio', 'MissFortune', 'Mordekaiser', 'Morgana', 'Nami',
            'Nasus', 'Nautilus', 'Nilah', 'Nunu', 'Olaf', 'Orianna', 'Ornn', 'Pantheon',
            'Poppy', 'Pyke', 'Rakan', 'Rammus', 'Renekton', 'Rengar', 'Riven', 'Rumble',
            'Samira', 'Senna', 'Seraphine', 'Sett', 'Shen', 'Shyvana', 'Singed', 'Sion',
            'Sivir', 'Sona', 'Soraka', 'Swain', 'Syndra', 'Talon', 'Teemo', 'Thresh',
            'Tristana', 'Tryndamere', 'TwistedFate', 'Twitch', 'Urgot', 'Varus', 'Vayne',
            'Veigar', 'Vex', 'Vi', 'Viego', 'Viktor', 'Vladimir', 'Volibear', 'Warwick',
            'Wukong', 'Xayah', 'XinZhao', 'Yasuo', 'Yone', 'Yuumi', 'Zed', 'Zeri', 'Ziggs',
            'Zoe', 'Zyra', 'Ryze', 'Nocturne', 'Zilean'
        ]);


        // Функция Debounce
        function debounce(func, wait, immediate) { let timeout; return function() { const context = this, args = arguments; const later = function() { timeout = null; if (!immediate) func.apply(context, args); }; const callNow = immediate && !timeout; clearTimeout(timeout); timeout = setTimeout(later, wait); if (callNow) func.apply(context, args); }; };

        // ПОРЯДОК ДРАФТА (стандартный)
        const draftOrder = [ { type: 'ban', team: 'blue', slot: 'blue-ban-1', text: 'Синие: Бан 1' }, { type: 'ban', team: 'red', slot: 'red-ban-1', text: 'Красные: Бан 1' }, { type: 'ban', team: 'blue', slot: 'blue-ban-2', text: 'Синие: Бан 2' }, { type: 'ban', team: 'red', slot: 'red-ban-2', text: 'Красные: Бан 2' }, { type: 'ban', team: 'blue', slot: 'blue-ban-3', text: 'Синие: Бан 3' }, { type: 'ban', team: 'red', slot: 'red-ban-3', text: 'Красные: Бан 3' }, { type: 'pick', team: 'blue', slot: 'blue-pick-1', text: 'Синие: Пик 1' }, { type: 'pick', team: 'red', slot: 'red-pick-1', text: 'Красные: Пик 1' }, { type: 'pick', team: 'red', slot: 'red-pick-2', text: 'Красные: Пик 2' }, { type: 'pick', team: 'blue', slot: 'blue-pick-2', text: 'Синие: Пик 2' }, { type: 'pick', team: 'blue', slot: 'blue-pick-3', text: 'Синие: Пик 3' }, { type: 'pick', team: 'red', slot: 'red-pick-3', text: 'Красные: Пик 3' }, { type: 'ban', team: 'red', slot: 'red-ban-4', text: 'Красные: Бан 4' }, { type: 'ban', team: 'blue', slot: 'blue-ban-4', text: 'Синие: Бан 4' }, { type: 'ban', team: 'red', slot: 'red-ban-5', text: 'Красные: Бан 5' }, { type: 'ban', team: 'blue', slot: 'blue-ban-5', text: 'Синие: Бан 5' }, { type: 'pick', team: 'red', slot: 'red-pick-4', text: 'Красные: Пик 4' }, { type: 'pick', team: 'blue', slot: 'blue-pick-4', text: 'Синие: Пик 4' }, { type: 'pick', team: 'blue', slot: 'blue-pick-5', text: 'Синие: Пик 5' }, { type: 'pick', team: 'red', slot: 'red-pick-5', text: 'Красные: Пик 5' } ];

        // --- Функции Таймера ---
        function stopTimer() { clearInterval(timerInterval); timerInterval = null; }
        function formatTime(seconds) { const minutes = Math.floor(seconds / 60); const remainingSeconds = seconds % 60; return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`; }
        function resetTimerDisplay() { timerDisplay.textContent = formatTime(draftTimerDuration); timerDisplay.style.color = '#e2e8f0'; timerDisplay.classList.remove('timer-running', 'timer-disabled'); timerDisplay.style.cursor = 'pointer'; timerDisplay.title = 'Начать драфт'; }
        function startTimer() { stopTimer(); timerSeconds = draftTimerDuration; timerDisplay.textContent = formatTime(timerSeconds); timerDisplay.style.color = '#e2e8f0'; timerDisplay.classList.add('timer-running'); timerDisplay.classList.remove('timer-disabled'); timerDisplay.style.cursor = 'default'; timerDisplay.title = ''; timerInterval = setInterval(() => { timerSeconds--; timerDisplay.textContent = formatTime(timerSeconds); if (timerSeconds <= 10) { timerDisplay.style.color = '#f87171'; } if (timerSeconds <= 0) { stopTimer(); timerDisplay.style.color = '#f87171'; } }, 1000); }

        // --- Функции Драфта ---
        function createChampionCard(champ) { const card = document.createElement('div'); card.className = 'champion-card'; card.dataset.championId = champ.id; card.dataset.championName = champ.name.toLowerCase(); card.dataset.roles = champ.roles ? champ.roles.join(',') : ''; const img = document.createElement('img'); img.src = champ.iconUrl; img.alt = champ.name; img.title = champ.name; img.className = 'w-full h-full object-cover block'; img.loading = 'lazy'; img.onerror = () => { const size = getComputedStyle(card).getPropertyValue('--card-size'); img.src = `https://placehold.co/${parseInt(size)}x${parseInt(size)}/cccccc/ffffff?text=Err`; img.title = `${champ.name} (Ошибка загр.)`; }; card.appendChild(img); card.addEventListener('click', () => handleChampionPreview(champ)); return card; }
        function displayChampions() { try { const currentSearch = championSearch.value; championGridElement.innerHTML = ''; currentChampionCards = []; const sortedChampions = [...champions].sort((a, b) => a.name.localeCompare(b.name, 'ru')); sortedChampions.forEach(champ => { const card = createChampionCard(champ); championGridElement.appendChild(card); currentChampionCards.push(card); }); updateCurrentActionDisplay(); updateChampionAvailability(); championSearch.value = currentSearch; filterChampions(); } catch (error) { console.error("Error in displayChampions:", error); } }
        function updateCurrentActionDisplay() { try { document.querySelectorAll('.pick-slot, .ban-slot').forEach(el => { el.classList.remove('highlight-action'); el.classList.remove('preview-flash'); }); previewedChampion = null; confirmPickBanButton.disabled = true; if (!isDraftStarted) { resetTimerDisplay(); stopTimer(); resetButton.disabled = false; nextDraftButton.disabled = true; } else if (currentStep < draftOrder.length) { isDraftComplete = false; const action = draftOrder[currentStep]; const activeSlot = document.getElementById(action.slot); if (activeSlot) { activeSlot.classList.add('highlight-action'); const isSlotFilledConfirmed = draftHistory.some(entry => entry.slotId === action.slot); if (!isSlotFilledConfirmed) { restoreSlotPlaceholder(activeSlot, action.slot, activeSlot.querySelector('.nickname-input')?.textContent || ''); } } deselectSwapSlots(); startTimer(); resetButton.disabled = true; nextDraftButton.disabled = true; } else { isDraftComplete = true; stopTimer(); timerDisplay.textContent = "Драфт Завершен!"; timerDisplay.style.color = '#4ade80'; timerDisplay.classList.add('timer-disabled'); timerDisplay.style.cursor = 'default'; timerDisplay.title = ''; document.querySelectorAll('.pick-slot').forEach(slot => { if (slot.dataset.championId) slot.style.cursor = 'pointer'; }); resetButton.disabled = false; nextDraftButton.disabled = false; } undoButton.disabled = draftHistory.length === 0 || !isDraftStarted; timerDisplay.disabled = isDraftStarted; if(!isDraftStarted) timerDisplay.classList.remove('timer-disabled'); swapButton.disabled = isDraftStarted; clearPicksButton.disabled = false; toggleTimerButton.disabled = isDraftStarted; priorityFilterButton.disabled = isDraftStarted; } catch (error) { console.error("Error in updateCurrentActionDisplay:", error); } }
        function updateChampionAvailability() { try { const combinedDisabled = new Set([...selectedChampions, ...globallyDisabledChampions]); currentChampionCards.forEach(card => { const champId = card.dataset.championId; const imgElement = card.querySelector('img'); const isDisabled = combinedDisabled.has(champId); card.classList.toggle('selected', selectedChampions.has(champId)); card.classList.toggle('disabled', isDisabled); if (imgElement) { imgElement.classList.toggle('grayscale', isDisabled); imgElement.classList.toggle('brightness-50', isDisabled); } }); } catch (error) { console.error("Error in updateChampionAvailability:", error); } }
        function handleChampionPreview(champion) { try { const isDisabled = selectedChampions.has(champion.id) || globallyDisabledChampions.has(champion.id); if (!isDraftStarted || isDraftComplete || currentStep >= draftOrder.length || isDisabled) { return; } const currentAction = draftOrder[currentStep]; const slotElement = document.getElementById(currentAction.slot); if (slotElement) { slotElement.classList.remove('preview-flash'); previewedChampion = champion; const existingNickname = slotElement.querySelector('.nickname-input')?.textContent || ''; fillSlot(slotElement, champion, currentAction.type, existingNickname); slotElement.classList.add('preview-flash'); confirmPickBanButton.disabled = false; } } catch (error) { console.error("Error in handleChampionPreview:", error); } }
        function handleConfirmPickBan() { try { if (!previewedChampion || !isDraftStarted || isDraftComplete || currentStep >= draftOrder.length) { return; } const championToConfirm = previewedChampion; const currentAction = draftOrder[currentStep]; const slotElement = document.getElementById(currentAction.slot); const isDisabled = selectedChampions.has(championToConfirm.id) || globallyDisabledChampions.has(championToConfirm.id); if (slotElement && !isDisabled) { slotElement.classList.remove('preview-flash'); let existingNickname = ''; if (currentAction.type === 'pick') { const nicknameInput = slotElement.querySelector('.nickname-input'); if (nicknameInput) { existingNickname = nicknameInput.textContent; } } if (currentAction.type === 'pick') { slotElement.dataset.championId = championToConfirm.id; } draftHistory.push({ championId: championToConfirm.id, slotId: currentAction.slot, step: currentStep, previousNickname: existingNickname, type: currentAction.type, team: currentAction.team }); selectedChampions.add(championToConfirm.id); currentStep++; previewedChampion = null; confirmPickBanButton.disabled = true; updateCurrentActionDisplay(); updateChampionAvailability(); filterChampions(); } else { previewedChampion = null; confirmPickBanButton.disabled = true; if (slotElement) { slotElement.classList.remove('preview-flash'); restoreSlotPlaceholder(slotElement, currentAction.slot, slotElement.querySelector('.nickname-input')?.textContent || ''); } } } catch (error) { console.error("Error in handleConfirmPickBan:", error); } }
        function fillSlot(slotElement, champion, type, keepNicknameText = '') { try { slotElement.innerHTML = ''; const img = document.createElement('img'); img.src = type === 'pick' ? champion.splashUrl : champion.iconUrl; img.alt = champion.name; img.title = champion.name; img.className = 'w-full h-full object-cover block absolute inset-0 z-0'; img.onerror = () => { const errorSpan = document.createElement('span'); errorSpan.className = 'text-[1.5vmin] text-red-400'; errorSpan.textContent = 'Err'; slotElement.innerHTML = ''; slotElement.appendChild(errorSpan); if (type === 'pick') { const nicknameInput = document.createElement('div'); nicknameInput.contentEditable = true; nicknameInput.className = 'nickname-input'; nicknameInput.textContent = keepNicknameText; slotElement.appendChild(nicknameInput); } }; slotElement.appendChild(img); if (type === 'pick') { const nicknameInput = document.createElement('div'); nicknameInput.contentEditable = true; nicknameInput.className = 'nickname-input'; nicknameInput.textContent = keepNicknameText; slotElement.appendChild(nicknameInput); } delete slotElement.dataset.championId; } catch (error) { console.error("Error in fillSlot:", error); } }
        function restoreSlotPlaceholder(slotElement, slotId, previousNickname = '') { try { const isConfirmed = draftHistory.some(entry => entry.slotId === slotId); if (isConfirmed && isDraftStarted) { slotElement.classList.remove('preview-flash'); return; } slotElement.innerHTML = ''; slotElement.classList.remove('preview-flash'); delete slotElement.dataset.championId; slotElement.style.cursor = 'default'; slotElement.title = ''; if (slotId.includes('-pick-')) { const nicknameInput = document.createElement('div'); nicknameInput.contentEditable = true; nicknameInput.className = 'nickname-input'; nicknameInput.textContent = previousNickname; slotElement.appendChild(nicknameInput); } } catch (error) { console.error("Error in restoreSlotPlaceholder:", error); } }
        function handleUndo() { try { if (draftHistory.length === 0 || !isDraftStarted) return; deselectSwapSlots(); const lastAction = draftHistory.pop(); currentStep = lastAction.step; selectedChampions.delete(lastAction.championId); const slotElement = document.getElementById(lastAction.slotId); if (slotElement) { restoreSlotPlaceholder(slotElement, lastAction.slotId, lastAction.previousNickname); slotElement.classList.remove('preview-flash'); } isDraftComplete = false; previewedChampion = null; confirmPickBanButton.disabled = true; updateCurrentActionDisplay(); updateChampionAvailability(); filterChampions(); document.querySelectorAll('.pick-slot').forEach(slot => slot.style.cursor = 'default'); } catch (error) { console.error("Error in handleUndo:", error); } }
        function resetDraft() { try { console.log("Resetting series..."); currentStep = 0; selectedChampions.clear(); draftHistory = []; isDraftComplete = false; isDraftStarted = false; deselectSwapSlots(); stopTimer(); draftTimerDuration = 30; resetTimerDisplay(); previewedChampion = null; confirmPickBanButton.disabled = true; isPriorityFilterActive = false; globallyDisabledChampions.clear(); globalBanHistory = []; displayGloballyBanned(); document.querySelectorAll('.pick-slot, .ban-slot').forEach((slot) => { restoreSlotPlaceholder(slot, slot.id, ''); slot.classList.remove('highlight-action', 'preview-flash'); }); document.querySelectorAll('.score-input').forEach(el => el.textContent = ''); const blueNameEl = document.getElementById('blue-team-name-h2'); const redNameEl = document.getElementById('red-team-name-h2'); if (blueNameEl) blueNameEl.textContent = 'Синяя Команда'; if (redNameEl) redNameEl.textContent = 'Красная Команда'; blueColumn.classList.add('draft-disabled'); redColumn.classList.add('draft-disabled'); championSearch.value = ''; currentRoleFilter = 'All'; filterButtons.forEach(btn => { btn.classList.toggle('active', btn.dataset.role === 'All'); }); if (priorityFilterButton) { priorityFilterButton.classList.remove('active'); priorityFilterButton.title = 'Показать только приоритетных чемпионов'; } displayChampions(); updateButtonStatesForNewDraft(); resetButton.disabled = false; document.querySelectorAll('.pick-slot').forEach(slot => slot.style.cursor = 'default'); } catch (error) { console.error("Error in resetDraft (full series reset):", error); } }

        // --- Сброс ТОЛЬКО текущей игры (сохраняет ники и глоб. баны) ---
        function resetCurrentDraftState() {
            console.log(`Resetting current game state...`);
            try {
                isDraftStarted = false; // <-- Сбрасываем флаг начала драфта
                currentStep = 0;
                selectedChampions.clear(); // Очищаем только локальные выборы
                draftHistory = [];
                isDraftComplete = false;
                previewedChampion = null;
                confirmPickBanButton.disabled = true;
                stopTimer();
                resetTimerDisplay();

                // Очищаем слоты, сохраняя ники
                document.querySelectorAll('.pick-slot, .ban-slot').forEach((slot) => {
                    let savedNickname = '';
                    const isPickSlot = slot.classList.contains('pick-slot');
                    if (isPickSlot) {
                        const nicknameInput = slot.querySelector('.nickname-input');
                        if (nicknameInput) savedNickname = nicknameInput.textContent;
                    }
                    restoreSlotPlaceholder(slot, slot.id, ''); // Очищает и создает новый input
                    if (isPickSlot) {
                        const newNicknameInput = slot.querySelector('.nickname-input');
                        if (newNicknameInput) newNicknameInput.textContent = savedNickname;
                        else console.warn(`Could not find NEW nickname input to restore for ${slot.id}`);
                    }
                    slot.classList.remove('highlight-action', 'preview-flash');
                    delete slot.dataset.championId;
                    slot.style.cursor = 'default';
                    slot.title = '';
                });
                 console.log("resetCurrentDraftState: Slots cleared, nicknames restored.");

                blueColumn.classList.remove('draft-disabled');
                redColumn.classList.remove('draft-disabled');
                updateButtonStatesForNewDraft();
                updateChampionAvailability(); // Применит глоб. баны
                filterChampions();
                displayGloballyBanned(); // Отобразит актуальные глоб. баны
                console.log("resetCurrentDraftState finished.");
            } catch (error) {
                 console.error("Error in resetCurrentDraftState:", error);
                 alert("Ошибка при сбросе для следующей игры. См. консоль.");
            }
        }

        function handleStartDraft() { try { if (isDraftStarted) return; isDraftStarted = true; blueColumn.classList.remove('draft-disabled'); redColumn.classList.remove('draft-disabled'); resetButton.disabled = true; clearPicksButton.disabled = false; swapButton.disabled = true; toggleTimerButton.disabled = true; priorityFilterButton.disabled = true; nextDraftButton.disabled = true; timerDisplay.classList.add('timer-running'); timerDisplay.classList.add('timer-disabled'); timerDisplay.style.cursor = 'default'; timerDisplay.title = ''; confirmPickBanButton.disabled = true; updateCurrentActionDisplay(); } catch (error) { console.error("Error in handleStartDraft:", error); } }
        function filterChampions() { try { const searchTerm = championSearch.value.toLowerCase().trim(); currentChampionCards.forEach(card => { const cardName = card.dataset.championName; const champId = card.dataset.championId; const champRoles = card.dataset.roles ? card.dataset.roles.split(',') : []; const searchMatch = cardName.includes(searchTerm) || champId.toLowerCase().includes(searchTerm); const roleMatch = currentRoleFilter === 'All' || (champRoles && champRoles.includes(currentRoleFilter)); const isPriority = priorityChampions.has(champId); const hideByPriorityFilter = isPriorityFilterActive && !isPriority; const isVisible = searchMatch && roleMatch && !hideByPriorityFilter; card.style.display = isVisible ? 'flex' : 'none'; const isDisabledGlobally = globallyDisabledChampions.has(champId); const isSelectedLocally = selectedChampions.has(champId); const isDisabled = isDisabledGlobally || isSelectedLocally; card.classList.toggle('selected', isSelectedLocally); card.classList.toggle('disabled', isDisabled); const imgElement = card.querySelector('img'); if (imgElement) { imgElement.classList.toggle('grayscale', isDisabled); imgElement.classList.toggle('brightness-50', isDisabled); } }); } catch (error) { console.error("Error in filterChampions:", error); } }
        function deselectSwapSlots() { if (selectedSwapSlotId) { const prevSelected = document.getElementById(selectedSwapSlotId); if (prevSelected) { prevSelected.classList.remove('swap-selected'); } selectedSwapSlotId = null; } }
        function handlePickContainerClick(event) { try { if (!isDraftComplete || event.target.classList.contains('nickname-input')) return; const clickedSlot = event.target.closest('.pick-slot'); if (!clickedSlot || !clickedSlot.dataset.championId) { deselectSwapSlots(); return; } const clickedSlotId = clickedSlot.id; if (!selectedSwapSlotId) { selectedSwapSlotId = clickedSlotId; clickedSlot.classList.add('swap-selected'); } else { if (selectedSwapSlotId === clickedSlotId) { deselectSwapSlots(); } else { const selectedSlot = document.getElementById(selectedSwapSlotId); if (!selectedSlot) { deselectSwapSlots(); return; } const team1 = selectedSwapSlotId.startsWith('blue') ? 'blue' : 'red'; const team2 = clickedSlotId.startsWith('blue') ? 'blue' : 'red'; if (team1 === team2) { const champId1 = selectedSlot.dataset.championId; const champId2 = clickedSlot.dataset.championId; const champ1 = getChampionById(champId1); const champ2 = getChampionById(champId2); const nick1 = selectedSlot.querySelector('.nickname-input')?.textContent || ''; const nick2 = clickedSlot.querySelector('.nickname-input')?.textContent || ''; if (champ1 && champ2) { fillSlot(selectedSlot, champ2, 'pick', nick2); fillSlot(clickedSlot, champ1, 'pick', nick1); } deselectSwapSlots(); } else { deselectSwapSlots(); selectedSwapSlotId = clickedSlotId; clickedSlot.classList.add('swap-selected'); } } } } catch (error) { console.error("Error in handlePickContainerClick:", error); } }

        // --- Логика смены сторон ---
        function handleSwapTeams() {
            try {
                const blueNameEl = document.getElementById('blue-team-name-h2');
                const redNameEl = document.getElementById('red-team-name-h2');
                const blueScoreEl = document.getElementById('blue-score');
                const redScoreEl = document.getElementById('red-score');

                // 1. Всегда меняем имена и счет
                if (blueNameEl && redNameEl) { const tempName = blueNameEl.textContent; blueNameEl.textContent = redNameEl.textContent; redNameEl.textContent = tempName; }
                if (blueScoreEl && redScoreEl) { const tempScore = blueScoreEl.textContent; blueScoreEl.textContent = redScoreEl.textContent; redScoreEl.textContent = tempScore; }

                // 2. Определяем, когда менять остальное
                if (isDraftComplete) {
                    // ПОСЛЕ ЗАВЕРШЕНИЯ ДРАФТА: Меняем пики/баны/ники
                    console.log("Swapping picks/bans/nicknames after draft completion...");
                    for (let i = 1; i <= 5; i++) {
                        const blueBan = document.getElementById(`blue-ban-${i}`); const redBan = document.getElementById(`red-ban-${i}`); if (blueBan && redBan) { const c = blueBan.innerHTML; blueBan.innerHTML = redBan.innerHTML; redBan.innerHTML = c; }
                        const bluePick = document.getElementById(`blue-pick-${i}`); const redPick = document.getElementById(`red-pick-${i}`);
                        if (bluePick && redPick) {
                            const bId = bluePick.dataset.championId; const rId = redPick.dataset.championId;
                            const bN = bluePick.querySelector('.nickname-input')?.textContent || ''; const rN = redPick.querySelector('.nickname-input')?.textContent || '';
                            const bC = getChampionById(bId); const rC = getChampionById(rId);
                            restoreSlotPlaceholder(bluePick, `blue-pick-${i}`, ''); restoreSlotPlaceholder(redPick, `red-pick-${i}`, '');
                            if (rC) fillSlot(bluePick, rC, 'pick', rN); else restoreSlotPlaceholder(bluePick, `blue-pick-${i}`, rN);
                            if (bC) fillSlot(redPick, bC, 'pick', bN); else restoreSlotPlaceholder(redPick, `red-pick-${i}`, bN);
                        }
                    }
                    deselectSwapSlots();
                } else if (!isDraftStarted) {
                    // ДО НАЧАЛА ДРАФТА: Меняем ТОЛЬКО ники
                    console.log("Swapping nicknames before draft starts...");
                    for (let i = 1; i <= 5; i++) {
                        const bluePickSlot = document.getElementById(`blue-pick-${i}`); const redPickSlot = document.getElementById(`red-pick-${i}`);
                        if (bluePickSlot && redPickSlot) {
                            const blueNickInput = bluePickSlot.querySelector('.nickname-input'); const redNickInput = redPickSlot.querySelector('.nickname-input');
                            if (blueNickInput && redNickInput) {
                                console.log(`[Swap Nick ${i}] Before: Blue="${blueNickInput.textContent}", Red="${redNickInput.textContent}"`);
                                const tempNick = blueNickInput.textContent; blueNickInput.textContent = redNickInput.textContent; redNickInput.textContent = tempNick;
                                console.log(`[Swap Nick ${i}] After: Blue="${blueNickInput.textContent}", Red="${redNickInput.textContent}"`);
                            } else { console.warn(`[Swap Nick ${i}] Nickname input not found.`); }
                        } else { console.warn(`[Swap Nick ${i}] Pick slot not found.`); }
                    }
                    deselectSwapSlots();
                } else { console.warn("Attempted to swap teams during an active draft."); }
            } catch (error) { console.error("Error in handleSwapTeams:", error); }
        }

        function handleClearPicksBans() { try { selectedChampions.clear(); draftHistory = []; currentStep = 0; isDraftComplete = false; isDraftStarted = false; deselectSwapSlots(); stopTimer(); resetTimerDisplay(); previewedChampion = null; confirmPickBanButton.disabled = true; document.querySelectorAll('.pick-slot, .ban-slot').forEach((slot) => { const isPick = slot.id.includes('-pick-'); const nickContent = isPick ? slot.querySelector('.nickname-input')?.textContent || '' : ''; restoreSlotPlaceholder(slot, slot.id, ''); if (isPick) { const nicknameInput = slot.querySelector('.nickname-input'); if(nicknameInput) nicknameInput.textContent = nickContent; } slot.classList.remove('highlight-action', 'preview-flash'); }); blueColumn.classList.add('draft-disabled'); redColumn.classList.add('draft-disabled'); updateChampionAvailability(); filterChampions(); updateButtonStatesForNewDraft(); } catch (error) { console.error("Error in handleClearPicksBans:", error); } }
        function handleToggleTimer() { try { if (isDraftStarted) return; if (draftTimerDuration === 30) { draftTimerDuration = 45; } else { draftTimerDuration = 30; } resetTimerDisplay(); toggleTimerButton.title = `Сменить время таймера (${draftTimerDuration === 30 ? '-> 45с' : '-> 30с'})`; console.log("Timer duration set to:", draftTimerDuration); } catch (error) { console.error("Error in handleToggleTimer:", error); } }
        function handleRoleFilterClick(event) { try { const clickedButton = event.currentTarget; currentRoleFilter = clickedButton.dataset.role; filterButtons.forEach(btn => btn.classList.remove('active')); clickedButton.classList.add('active'); filterChampions(); } catch (error) { console.error("Error in handleRoleFilterClick:", error); } }
        function handlePriorityFilterToggle() { try { isPriorityFilterActive = !isPriorityFilterActive; if (priorityFilterButton) { priorityFilterButton.classList.toggle('active', isPriorityFilterActive); priorityFilterButton.title = isPriorityFilterActive ? 'Показать всех чемпионов' : 'Показать только приоритетных чемпионов'; } console.log('Priority filter active:', isPriorityFilterActive); filterChampions(); } catch (error) { console.error("Error in handlePriorityFilterToggle:", error); } }
        function displayGloballyBanned() { try { if (!globallyBannedDisplay) return; const blueBansContainer = document.getElementById('global-bans-blue'); const redBansContainer = document.getElementById('global-bans-red'); if (!blueBansContainer || !redBansContainer) { return; } blueBansContainer.innerHTML = ''; redBansContainer.innerHTML = ''; if (globalBanHistory.length > 0) { globallyBannedDisplay.classList.remove('hidden'); globalBanHistory.forEach(banInfo => { const champ = getChampionById(banInfo.championId); if (champ) { const iconDiv = document.createElement('div'); iconDiv.className = 'global-ban-icon'; iconDiv.title = `${champ.name} (Заблокирован ${banInfo.team === 'blue' ? 'синими' : 'красными'})`; const img = document.createElement('img'); img.src = champ.iconUrl; img.alt = champ.name; img.onerror = () => { img.src = `https://placehold.co/${getComputedStyle(iconDiv).getPropertyValue('--global-ban-icon-min-size')}x${getComputedStyle(iconDiv).getPropertyValue('--global-ban-icon-min-size')}/cccccc/ffffff?text=Err`; }; iconDiv.appendChild(img); if (banInfo.team === 'blue') { blueBansContainer.appendChild(iconDiv); } else { redBansContainer.appendChild(iconDiv); } } }); } else { globallyBannedDisplay.classList.add('hidden'); } } catch (error) { console.error("Error in displayGloballyBanned:", error); } }
        function handleNextDraft() { console.log("handleNextDraft: START"); try { if (!isDraftComplete) { console.warn("handleNextDraft: Draft not complete."); return; } console.log("handleNextDraft: Draft complete, proceeding..."); draftHistory.forEach(action => { if (action.type === 'pick') { globalBanHistory.push({ championId: action.championId, team: action.team }); globallyDisabledChampions.add(action.championId); } }); console.log("handleNextDraft: Updated globalBanHistory:", globalBanHistory); console.log("handleNextDraft: Updated globallyDisabledChampions:", globallyDisabledChampions); resetCurrentDraftState(); console.log("handleNextDraft: Current draft state reset."); } catch (error) { console.error("Error in handleNextDraft:", error); alert("Ошибка при переходе к следующему драфту. См. консоль."); } console.log("handleNextDraft: END"); }
        function updateButtonStatesForNewDraft() { undoButton.disabled = true; resetButton.disabled = false; swapButton.disabled = false; clearPicksButton.disabled = false; toggleTimerButton.disabled = false; priorityFilterButton.disabled = false; nextDraftButton.disabled = true; timerDisplay.disabled = false; timerDisplay.classList.remove('timer-disabled'); timerDisplay.style.color = '#e2e8f0'; timerDisplay.title = 'Начать драфт'; }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => { console.log("DOM Loaded. Initializing script..."); try { const elementsToCheck = { startButton, resetButton, undoButton, swapButton, clearPicksButton, toggleTimerButton, confirmPickBanButton, priorityFilterButton, nextDraftButton, globallyBannedDisplay, championSearch, blueColumn, redColumn, championGridElement }; let allElementsFound = true; for (const key in elementsToCheck) { if (!elementsToCheck[key]) { console.error(`Initialization Error: Element ${key} not found!`); allElementsFound = false; } } if (!allElementsFound) { throw new Error("One or more essential DOM elements not found during initialization."); } console.log("All essential elements found."); console.log("Attaching event listeners..."); timerDisplay.addEventListener('click', handleStartDraft); resetButton.addEventListener('click', resetDraft); undoButton.addEventListener('click', handleUndo); swapButton.addEventListener('click', handleSwapTeams); clearPicksButton.addEventListener('click', handleClearPicksBans); toggleTimerButton.addEventListener('click', handleToggleTimer); confirmPickBanButton.addEventListener('click', handleConfirmPickBan); priorityFilterButton.addEventListener('click', handlePriorityFilterToggle); nextDraftButton.addEventListener('click', handleNextDraft); championSearch.addEventListener('input', debounce(filterChampions, 250)); filterButtons.forEach(button => { if (!button) throw new Error("Filter button element is null"); button.addEventListener('click', handleRoleFilterClick); }); blueColumn.addEventListener('click', handlePickContainerClick); redColumn.addEventListener('click', handlePickContainerClick); console.log("Event listeners attached."); console.log("Calling initial resetDraft..."); try { resetDraft(); console.log("Initial resetDraft completed."); } catch (resetError) { console.error("Error during initial resetDraft:", resetError); } console.log("Draft simulator initialized successfully (Fearless Draft added)."); } catch (initError) { console.error("Initialization failed:", initError); alert("Критическая ошибка инициализации симулятора драфта. Проверьте консоль (F12)."); } });

    } catch (globalError) { console.error("A critical error occurred:", globalError); alert("Произошла критическая ошибка. Пожалуйста, проверьте консоль (F12)."); }
    </script>

</body>
</html>